<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset = "utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>IOAA 2016 - Bhubaneshwar, India</title>

		<!--Bootstrap-->
		<link href = "/static/css/bootstrap.min.css" rel = "stylesheet" />
		<!!--Custom CSS-->
		<link href = "/static/css/main.css" rel = "stylesheet" />

        <link href = "media/favicon.ico" rel="shortcut icon" type="image/x-icon"/>
        <link href = "media/favicon.ico" rel="icon" type="image/x-icon"/>	
	</head>

    <body>
        <div id = "sp-header-wrapper" class = "navbar navbar-defaul navbar-fixed-top">
			<div class = "container-fluid">
                <div class = "navbar-header">
                    <a class="navbar-brand" href = "http://www.ioaa2016.in">
                        <img alt="ipho-logo" src = "/media/ioaa-logo.png" />
                    </a>
                </div>
			</div>
			<div id = "tifr-mast">
				<div id = "tifr-logo"><img class = "right" alt="tifr-logo" src = "/media/tifr-logo-s.png" />
				<br />
				<div id = "out-button" class="right">
				<button id = "chpass-button" type = "button" class = "btn btn-default btn-sm">Change Password</button>
				<button id = "logout-button" type = "button"  class = "btn btn-default btn-sm">
					<span class="glyphicon glyphicon-log-out"></span> Log out
				</button>
				</div>
				<br />
				</div>
				<div id = "hbc-tifr" style = "position:relative;left:110px;">
					<div id = "hbc">Homi Bhabha Centre for Science Education</div>
					<div id = "tifr">Tata Institute of Fundamental Research</div>
				</div>
			</div>
		</div>
		
        <div id = "document" style="width:80%">
            <div role = "tabpanel">
                    <ul class = "nav nav-pills" id = "nemo">
                        <li role = "presentation" class = "active"><a href = "#home" aria-controls="home" role="tab" data-toggle="tab" onclick = 'send_list_dir("uploads");send_list_dir("downloads");'>Home</a></li>
                        <li id = "cvoteb" role = "presentation" style = "display:none;"><a href = "#cvote" aria-controls="cvote" role="tab" data-toggle="tab">Cast Vote</a></li>
                        <li id = "rvoteb" role = "presentation" style = "display:none;"><a href = "#rvote" aria-controls="rvote" role="tab" data-toggle="tab">Results</a></li>
                        <li id = "fbb" role = "presentation" style = "display:none;"><a href = "#fb" aria-controls="fb" role="tab" data-toggle="tab">Feedback</a></li>
					    <li id = "fbb_all" role = "presentation"><a href = "#fb_all" aria-controls="fb_all" role="tab" data-toggle="tab">All Feedback</a></li>
                    </ul>
            </div>
            
            <div class = "tab-content">
                <!-- Home tab -->
                <div role="tabpanel" class="tab-pane active" id = "home" >
                    <table class ="table table-stripped" style="table-layout:fixed;">
                        <col style="width:50%"> 
                        <col style="width:50%"> 
			<thead>
            
            <!--            
                <tr>
                    <th>Table of Constants Upload</th>
                    <th>Theory</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td id = "TOC_form">
                        <form id        =  "upload_form"
                            enctype   =  "multipart/form-data"
                            action    =  "/uploadedTOC"
                            method    =  "post"
                        >
                        <div style="position:relative;">
                                    <a class='btn btn-default' href='javascript:;'>
                                        Choose File...
                                        <input type="file" style='position:absolute;z-index:2;top:0;left:0;filter: alpha(opacity=0);-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";opacity:0;background-color:transparent;color:transparent;' id = "file_upload_TOC" name="user_file" size="40"  onchange='$("#upload-file-info_TOC").html($(this).val().replace("C:\\fakepath\\","")) ;'>
                                    </a>
                                    &nbsp;
                                   <span class='label label-info' id="upload-file-info_TOC"></span>
                         </div>
                        <input class = "btn btn-default" type="submit" value="Upload File" name="submit" onclick = 'return emptyfile_check_TOC();'/>
                        </form>
                     </td>
                    <td id = "T_form">
                        <form id        =  "upload_form"
                            enctype   =  "multipart/form-data"
                            action    =  "/uploadedT"
                            method    =  "post"
                        >
                        <div style="position:relative;">
                                    <a class='btn btn-default' href='javascript:;'>
                                        Choose File...
                                        <input type="file" style='position:absolute;z-index:2;top:0;left:0;filter: alpha(opacity=0);-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";opacity:0;background-color:transparent;color:transparent;' id = "file_upload_T" name="user_file" size="40"  onchange='$("#upload-file-info_T").html($(this).val().replace("C:\\fakepath\\","")) ;'>
                                    </a>
                                    &nbsp;
                                   <span class='label label-info' id="upload-file-info_T"></span>
                         </div>
                        <input class = "btn btn-default" type="submit" value="Upload File" name="submit" onclick = 'return emptyfile_check_T();'/>
                        </form>
                     </td>
                </tr>
            </tbody>
            --> 
            
            <!--
			<thead>
                <tr>
                    <th>Table of Constants Upload</th>
                    <th>Data</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td id = "TOC_form">
                        <form id        =  "upload_form"
                            enctype   =  "multipart/form-data"
                            action    =  "/uploadedTOC"
                            method    =  "post"
                        >
                        <div style="position:relative;">
                                    <a class='btn btn-default' href='javascript:;'>
                                        Choose File...
                                        <input type="file" style='position:absolute;z-index:2;top:0;left:0;filter: alpha(opacity=0);-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";opacity:0;background-color:transparent;color:transparent;' id = "file_upload_TOC" name="user_file" size="40"  onchange='$("#upload-file-info_TOC").html($(this).val().replace("C:\\fakepath\\","")) ;'>
                                    </a>
                                    &nbsp;
                                   <span class='label label-info' id="upload-file-info_TOC"></span>
                         </div>
                        <input class = "btn btn-default" type="submit" value="Upload File" name="submit" onclick = 'return emptyfile_check_TOC();'/>
                        </form>
                     </td>
                    <td id = "D_form">
                        <form id        =  "upload_form"
                            enctype   =  "multipart/form-data"
                            action    =  "/uploadedD"
                            method    =  "post"
                        >
                        <div style="position:relative;">
                                    <a class='btn btn-default' href='javascript:;'>
                                        Choose File...
                                        <input type="file" style='position:absolute;z-index:2;top:0;left:0;filter: alpha(opacity=0);-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";opacity:0;background-color:transparent;color:transparent;' id = "file_upload_D" name="user_file" size="40"  onchange='$("#upload-file-info_D").html($(this).val().replace("C:\\fakepath\\","")) ;'>
                                    </a>
                                    &nbsp;
                                   <span class='label label-info' id="upload-file-info_D"></span>
                         </div>
                        <input class = "btn btn-default" type="submit" value="Upload File" name="submit" onclick = 'return emptyfile_check_D();'/>
                        </form>
                     </td>
                </tr>
            </tbody>
            -->

            <!-- Observation and Data Meeting -->
            <thead>
                <tr>
                    <th>Planetarium (OP) </th>
                    <th>Planetarium (OP) Instructions</th>
                </tr>
            </thead>

            <tbody>
                <tr>
                    <td id = "OP_form">
                        <form id        =  "upload_form"
                            enctype   =  "multipart/form-data"
                            action    =  "/uploadedOP"
                            method    =  "post"
                        >
                        <div style="position:relative;">
                                    <a class='btn btn-default' href='javascript:;'>
                                        Choose File...
                                        <input type="file" style='position:absolute;z-index:2;top:0;left:0;filter: alpha(opacity=0);-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";opacity:0;background-color:transparent;color:transparent;' id = "file_upload_OP" name="user_file" size="40"  onchange='$("#upload-file-info_OP").html($(this).val().replace("C:\\fakepath\\","")) ;'>
                                    </a>
                                    &nbsp;
                                   <span class='label label-info' id="upload-file-info_OP"></span>
                         </div>
                        <input class = "btn btn-default" type="submit" value="Upload File" name="submit" onclick = 'return emptyfile_check_OP();'/>
                        </form>
                     </td>

                    <td id = "OPi_form">
                        <form id        =  "upload_form"
                            enctype   =  "multipart/form-data"
                            action    =  "/uploadedOPi"
                            method    =  "post"
                        >
                        <div style="position:relative;">
                                    <a class='btn btn-default' href='javascript:;'>
                                        Choose File...
                                        <input type="file" style='position:absolute;z-index:2;top:0;left:0;filter: alpha(opacity=0);-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";opacity:0;background-color:transparent;color:transparent;' id = "file_upload_OPi" name="user_file" size="40"  onchange='$("#upload-file-info_OPi").html($(this).val().replace("C:\\fakepath\\","")) ;'>
                                    </a>
                                    &nbsp;
                                   <span class='label label-info' id="upload-file-info_OPi"></span>
                         </div>
                        <input class = "btn btn-default" type="submit" value="Upload File" name="submit" onclick = 'return emptyfile_check_OPi();'/>
                        </form>
                     </td>
                 </tr>
            </tbody>

            <thead>
                <tr>
                    <th>Sky Map (OM) </th>
                    <th>Sky Map (OM) Instructions</th>
                </tr>
            </thead>

            <tbody>
                <tr>
                    <td id = "OM_form">
                        <form id        =  "upload_form"
                            enctype   =  "multipart/form-data"
                            action    =  "/uploadedOM"
                            method    =  "post"
                        >
                        <div style="position:relative;">
                                    <a class='btn btn-default' href='javascript:;'>
                                        Choose File...
                                        <input type="file" style='position:absolute;z-index:2;top:0;left:0;filter: alpha(opacity=0);-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";opacity:0;background-color:transparent;color:transparent;' id = "file_upload_OM" name="user_file" size="40"  onchange='$("#upload-file-info_OM").html($(this).val().replace("C:\\fakepath\\","")) ;'>
                                    </a>
                                    &nbsp;
                                   <span class='label label-info' id="upload-file-info_OM"></span>
                         </div>
                        <input class = "btn btn-default" type="submit" value="Upload File" name="submit" onclick = 'return emptyfile_check_OM();'/>
                        </form>
                     </td>

                    <td id = "OMi_form">
                        <form id        =  "upload_form"
                            enctype   =  "multipart/form-data"
                            action    =  "/uploadedOMi"
                            method    =  "post"
                        >
                        <div style="position:relative;">
                                    <a class='btn btn-default' href='javascript:;'>
                                        Choose File...
                                        <input type="file" style='position:absolute;z-index:2;top:0;left:0;filter: alpha(opacity=0);-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";opacity:0;background-color:transparent;color:transparent;' id = "file_upload_OMi" name="user_file" size="40"  onchange='$("#upload-file-info_OMi").html($(this).val().replace("C:\\fakepath\\","")) ;'>
                                    </a>
                                    &nbsp;
                                   <span class='label label-info' id="upload-file-info_OMi"></span>
                         </div>
                        <input class = "btn btn-default" type="submit" value="Upload File" name="submit" onclick = 'return emptyfile_check_OMi();'/>
                        </form>
                     </td>
                 </tr>
            </tbody>

            <thead>
                <tr>
                    <th>Telescope (OT) </th>
                    <th>Telescope (OT) Instructions</th>
                </tr>
            </thead>

            <tbody>
                <tr>
                    <td id = "OT_form">
                        <form id        =  "upload_form"
                            enctype   =  "multipart/form-data"
                            action    =  "/uploadedOT"
                            method    =  "post"
                        >
                        <div style="position:relative;">
                                    <a class='btn btn-default' href='javascript:;'>
                                        Choose File...
                                        <input type="file" style='position:absolute;z-index:2;top:0;left:0;filter: alpha(opacity=0);-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";opacity:0;background-color:transparent;color:transparent;' id = "file_upload_OT" name="user_file" size="40"  onchange='$("#upload-file-info_OT").html($(this).val().replace("C:\\fakepath\\","")) ;'>
                                    </a>
                                    &nbsp;
                                   <span class='label label-info' id="upload-file-info_OT"></span>
                         </div>
                        <input class = "btn btn-default" type="submit" value="Upload File" name="submit" onclick = 'return emptyfile_check_OT();'/>
                        </form>
                     </td>

                    <td id = "OTi_form">
                        <form id        =  "upload_form"
                            enctype   =  "multipart/form-data"
                            action    =  "/uploadedOTi"
                            method    =  "post"
                        >
                        <div style="position:relative;">
                                    <a class='btn btn-default' href='javascript:;'>
                                        Choose File...
                                        <input type="file" style='position:absolute;z-index:2;top:0;left:0;filter: alpha(opacity=0);-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";opacity:0;background-color:transparent;color:transparent;' id = "file_upload_OTi" name="user_file" size="40"  onchange='$("#upload-file-info_OTi").html($(this).val().replace("C:\\fakepath\\","")) ;'>
                                    </a>
                                    &nbsp;
                                   <span class='label label-info' id="upload-file-info_OTi"></span>
                         </div>
                        <input class = "btn btn-default" type="submit" value="Upload File" name="submit" onclick = 'return emptyfile_check_OTi();'/>
                        </form>
                     </td>
                 </tr>
            </tbody>

            <thead>
                <tr>
                    <th>Group (G) </th>
                </tr>
            </thead>

            <tbody>
                <tr>
                    <td id = "G_form">
                        <form id        =  "upload_form"
                            enctype   =  "multipart/form-data"
                            action    =  "/uploadedG"
                            method    =  "post"
                        >
                        <div style="position:relative;">
                                    <a class='btn btn-default' href='javascript:;'>
                                        Choose File...
                                        <input type="file" style='position:absolute;z-index:2;top:0;left:0;filter: alpha(opacity=0);-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";opacity:0;background-color:transparent;color:transparent;' id = "file_upload_G" name="user_file" size="40"  onchange='$("#upload-file-info_G").html($(this).val().replace("C:\\fakepath\\","")) ;'>
                                    </a>
                                    &nbsp;
                                   <span class='label label-info' id="upload-file-info_G"></span>
                         </div>
                        <input class = "btn btn-default" type="submit" value="Upload File" name="submit" onclick = 'return emptyfile_check_G();'/>
                        </form>
                     </td>
                 </tr>
            </tbody>
        </table>

                    <table id='download_table' class='table table-bordered table-hover'>
                        <thead>
                            <tr><th>Downloads</th></tr>
                        </thead>
                        <tbody id="download_table_body">
                        </tbody>
                    </table>
                    <table id='upload_table' class='table table-bordered table-hover'>        
                        <thead>
                            <tr><th>Uploads</th></tr>
                        </thead>
                        <tbody id="upload_table_body">
                        </tbody>
                    </table>

                </div>
                
                <div role="tabpanel" class="tab-pane" id = "cvote">
                        <p id = "vote-body"></p>
                        <form>
                            <div class="form-group" id = "vote-opts">
                            </div>	
                        </form>
                        <br />
                        <font>Time to vote: <span id = "timer"></span> seconds.</font>
                </div>
                
                <div role="tabpanel" class="tab-pane" id = "rvote"></div>
                
                <div role="tabpanel" class="tab-pane" id = "fb">
                    <h4 id = "fbHead">Feedback for </h4>
                    <form id = "form-feedback">
                        <div class="form-group" id = "fb-dropdown">
                           <label for = "fbMenu">Question:</label>
                           <select class = "form-control" id = "fbMenu">
                           </select>    
                        </div>
                        <div class = "form-group" id = "fb-content">
                            <label for = "comment">Comment:</label>
                            <textarea class = "form-control" rows = "5" id = "comment"></textarea>
                        </div>
                        <button type="submit" class="btn btn-default" id = "fb_submit" onclick='alert("Your feedback has been submitted successfully.")'>Submit</button>
                    </form>
                    
                    <div id = "fb_data">
                        <table style = "table-layout:fixed;" class = "table table-bordered table-hover" id = "fb_data_table">
                            <col style="width:30%"> 
                            <col style="width:10%"> 
                            <col style="width:60%"> 
                            <thead>
                            <tr>
                                <th style="text-align:center"><div class="btn btn-info">Time</div></th>
                                <th style="text-align:center"><div class="btn btn-info">QID</div></th>
                                <th style="text-align:center"><div class="btn btn-info">Content</div></th>
                            </tr>
                            </thead>
                            <tbody id = "fb_data_table_body">
                            </tbody>
                        </table>
                    </div>    
                </div>

                <div role="tabpanel" class="tab-pane" id = "fb_all"> 
                <div id = "fb_data">
                    <table style = "table-layout:fixed;" class = "table table-bordered table-hover tablesorter" id = "fb_data_table_all">
                        <thead>
                        <tr>
                            <th width = "200px" style="text-align:center"><div class="btn btn-info">Time <div class="glyphicon glyphicon-sort-by-attributes"</div></div></th>
                            <th width = "110px" style="text-align:center"><div class="btn btn-info">Country <div class="glyphicon glyphicon-sort-by-attributes"</div></div></th>
                            <th width = "100px" style="text-align:center"><div class="btn btn-info">QID <div class="glyphicon glyphicon-sort-by-attributes"</div></div></th>
                            <th width = "400px"style="text-align:center"><div class="btn btn-info">Content <div class="glyphicon glyphicon-sort-by-attributes"</div></div></th>
                            <th width = "40px" style="text-align:center"><div class="btn btn-info">S</div></th>
                        </tr>
                        </thead>
                        <tbody id = "fb_data_table_body_all">
                        </tbody>
                    </table>
                </div>    
            </div>
            </div>
        </div>
        
        <div id="sidebar-wrapper" style="width:20%">
            <table class="table table-hover" id = "country_data_table" style="table-layout:fixed;">
            <col style="width:50%">
            <col style="width:50%">
            </table>
            <table class="table" id = "message-board">
            <thead id = "message-board-head">
                <tr><th>Message Board</th></tr>
            </thead>
            <tbody id="message-board-body"></tbody> 
            </table>
        </div>
    
       <footer id="sp-footer-wrapper" style="bottom:0px;">
                	<div class="container">
                        <div class="row-fluid" id="footer">
                             <div id="sp-footer1" class="span6" style="text-align:center">
                                 <span>Copyright &copy; Homi Bhabha Centre for Science Education, TIFR</span>
                                 <br /><span>Mumbai - India </span> 
                             </div>
                         </div>
                	</div>
        </footer>   	
        
        <!-- jQuery -->
		<script src = "/static/js/jquery.min.js"></script>
		<script src = "/static/js/bootstrap.min.js"></script>
        <script src = "/static/js/knockout-2.2.0.js"></script>
        <script src = "/static/js/jquery.tablesorter.js"></script>
		<script src = "/static/js/Chart.min.js"></script>
		<script src = "/socket.io/socket.io.js"></script>
        <script>
            /*Theory Meeting
            //gets the element by its id
            var TOC_file = document.getElementById('file_upload_TOC');
            //binds to onchange event of the input field
            TOC_file.addEventListener('change', function() 
            {
                //this.files[0].size gets the size of your file.
                if(this.files[0].size > 104857600)
                {
                    alert("File limit (100 MB) exceeded.");
                    window.location = '/';
                }
                
            });
            var T_file = document.getElementById('file_upload_T');
            //binds to onchange event of the input field
            T_file.addEventListener('change', function() 
            {
                //this.files[0].size gets the size of your file.
                if(this.files[0].size > 104857600)
                {
                    alert("File limit (100 MB) exceeded.");
                    window.location = '/';
                }
                
            });
            var D_file = document.getElementById('file_upload_D');
            //binds to onchange event of the input field
            D_file.addEventListener('change', function() 
            {
                //this.files[0].size gets the size of your file.
                if(this.files[0].size > 104857600)
                {
                    alert("File limit (100 MB) exceeded.");
                    window.location = '/';
                }
                
            });
            */
            var OP_file = document.getElementById('file_upload_OP');
            //binds to onchange event of the input field
            OP_file.addEventListener('change', function() 
            {
                //this.files[0].size gets the size of your file.
                if(this.files[0].size > 104857600)
                {
                    alert("File limit (100 MB) exceeded.");
                    window.location = '/';
                }
                
            });
            var OPi_file = document.getElementById('file_upload_OPi');
            //binds to onchange event of the input field
            OPi_file.addEventListener('change', function() 
            {
                //this.files[0].size gets the size of your file.
                if(this.files[0].size > 104857600)
                {
                    alert("File limit (100 MB) exceeded.");
                    window.location = '/';
                }
                
            });
            var OM_file = document.getElementById('file_upload_OM');
            //binds to onchange event of the input field
            OM_file.addEventListener('change', function() 
            {
                //this.files[0].size gets the size of your file.
                if(this.files[0].size > 104857600)
                {
                    alert("File limit (100 MB) exceeded.");
                    window.location = '/';
                }
                
            });
            var OMi_file = document.getElementById('file_upload_OMi');
            //binds to onchange event of the input field
            OMi_file.addEventListener('change', function() 
            {
                //this.files[0].size gets the size of your file.
                if(this.files[0].size > 104857600)
                {
                    alert("File limit (100 MB) exceeded.");
                    window.location = '/';
                }
                
            });
            var OT_file = document.getElementById('file_upload_OT');
            //binds to onchange event of the input field
            OT_file.addEventListener('change', function() 
            {
                //this.files[0].size gets the size of your file.
                if(this.files[0].size > 104857600)
                {
                    alert("File limit (100 MB) exceeded.");
                    window.location = '/';
                }
                
            });
            var OTi_file = document.getElementById('file_upload_OTi');
            //binds to onchange event of the input field
            OTi_file.addEventListener('change', function() 
            {
                //this.files[0].size gets the size of your file.
                if(this.files[0].size > 104857600)
                {
                    alert("File limit (100 MB) exceeded.");
                    window.location = '/';
                }
                
            });
            var G_file = document.getElementById('file_upload_G');
            //binds to onchange event of the input field
            G_file.addEventListener('change', function() 
            {
                //this.files[0].size gets the size of your file.
                if(this.files[0].size > 104857600)
                {
                    alert("File limit (100 MB) exceeded.");
                    window.location = '/';
                }
                
            });


            //to protect from unload
            window.onbeforeunload = function() 
            {
                //send directory listing signal before refesh
                if($("#cvoteb").is(":visible"))
                    return 'You will lose your chance to vote if you continue. Are you sure?';
            };
            
            var socket = io();
            var fb_current = '';
            var num_of_leaders = '';
            var current_sort_order = [];     


            socket.on('end-ack',function()
            {
                window.location = '/auth.html';
            });
            socket.on('disconnect',function()
            {
                console.log('Disconnected');
                socket.io.reconnect();
            });	
            socket.on('super_refresh',function()
            {
                location.reload();
            });
           
            socket.on('num_of_leaders',function(value)
            {
                num_of_leaders = value;
            });
            
            //DONT PUT THIS IN DOCUMENT READY SCRIPT
            //function to disableF5
            function disableF5(e) { if ((e.which || e.keyCode) == 116) e.preventDefault(); };
                
            //document ready script
            $(document).ready(function()
            {
  
                  $("#fb_data_table_all").tablesorter();
                  $("#fb_data_table_all").on("sortEnd",function(event){
                      current_sort_order = event.target.config.sortList;
                      });
                socket.emit("list-dir","/uploads");socket.emit("list-dir","/downloads");
                var uptimer = setInterval(function()
                {
                    send_list_dir('uploads');
                    send_list_dir('downloads');
                },10000);
                send_list_dir('uploads');
                send_list_dir('downloads');
                $('#nemo a:first').tab('show');
                //socket.io controls
                $("#logout-button").click(function()
                {
                    socket.emit('end');
                });
                $("#chpass-button").click(function()
                {
                    window.location = '/chpass.html';
                });

                fbtimer = setInterval(function(){
                    request_fb_all(fb_current);    
                },10000);
                fb_current = '';
                request_fb_all(fb_current);

            });
         
            
            function request_fb(current)
            {
                var uData = {};
                uData['current'] = current;
                $.ajax({
                        method:"POST",
                        url:'/request_fb_leader',
                        data:uData,
                        dataType:"json"
                        })
                .done(function(data){
                       var feeds = data['feeds'];
                 
                        $("#fb_data_table_body").html('');
                        for(var feed in feeds)
                        {
                            var ll = '';
                            for(var ff in feeds[feed].content) ll = ll + feeds[feed].content[ff] + '<br />';
                            var field = '<tr id = "fb_row"><td>'+feeds[feed].time + '</td><td>'+feeds[feed].qid+'</td><td>'+ll+'</td></tr>';
                            var Field = $(field);
                            $("#fb_data_table_body").append(Field);
                        }
                        });
            }
            function request_fb_all(current)
            {
                var uData = {};
                uData['current'] = current;
                $.ajax({
                        method:"POST",
                        url:'/request_fb',
                        data:uData,
                        dataType:"json"
                        })
                .done(function(data){
                       var feeds = data['feeds'];
                 
                        $("#fb_data_table_body_all").html('');
                        for(var feed in feeds)
                        {
                            var ll = '';
                            for(var ff in feeds[feed].content) ll = ll + feeds[feed].content[ff] + '<br />';
                            if(feeds[feed].done == false)
                            {
                            var field = '<tr id = "fb_row"><td>'+feeds[feed].time + '</td><td>' + feeds[feed].country_code+'</td><td>'+feeds[feed].qid+'</td><td>'+ll+'</td><td style="margin-left:10px;" class="btn btn-danger glyphicon glyphicon-remove"></td></tr>';
                            } 
                            else 
                            {
                            var field = '<tr id = "fb_row"><td>'+feeds[feed].time + '</td><td>' + feeds[feed].country_code+'</td><td>'+feeds[feed].qid+'</td><td>'+ll+'</td><td style="margin-left:10px;" class="btn btn-success glyphicon glyphicon-ok"><span style = "font-size:0">1</span></td></tr>';
                            } 
                            var Field = $(field);
                            $("#fb_data_table_body_all").append(Field);
                        }
                        $("#fb_data_table_all").trigger('update');
                        setTimeout(function(){ $("#fb_data_table_all").trigger( 'sorton', [ current_sort_order ] ) },10);
                        });
            }

            //AJAX requests

            function get_subparts(val) 
            {
                var uData = {};
                uData["val"] = val;
                $.ajax({
                        method:"POST",
                        url:'get_subparts',
                        data:uData,
                        dataType:"json"
                        })
                .done(function(data){
                        var subparts = data['subparts'];
                        var elem_fb = $("#fbMenu");
                        var htmlstr = '';
                        for(var i in subparts)
                        {
                            htmlstr += '<option>'+subparts[i]+'</option>';
                        }
                        elem_fb.html(htmlstr);
                        });
            }

            function send_list_dir(folder)
            {
                var uData = {};
                uData["folder"] = folder;
                $.ajax({
                        method:"POST",
                        url:'/list_dir',
                        data:uData,
                        dataType:"json"
                        })
                .done(function(data){
                            var id = data['id'];
                            var directory_path = data['directory_path'];
                            var files = data['files'];
                            if(id == "download")
                            {
                                //var table = "<table id='download_table' class='table table-hover'><thead><tr><th>Downloads</th></tr></thead>";
                                var table = document.getElementById("download_table");
                                table.innerHTML = '';
                                     
                                for(var i = 0;i < files.length;i++)
                                {
                                    var row = table.insertRow(i);
                                    var cell = row.insertCell(0);
                                    cell.innerHTML =' <a href="' + directory_path + files[i].toString() + '">' + files[i].toString() + '</a>';
                                    //table += '<tr><td><a href="' + directory_path + files[i].toString() + '">' + files[i].toString() + '</a></td></tr>';
                                }
                                var row = table.insertRow(0);
                                var cell = row.insertCell(0);
                                cell.innerHTML ='<b>Downloads<b>';
                                //table += "</table>";
                                //$("#download_table").remove();
                                //$("#home").append(table);
                            }
                            else
                            {
                                var table = document.getElementById("upload_table");
                                table.innerHTML = '';
                                //var table = "<table id='upload_table' class='table table-hover'><thead><tr><th>Uploads</th></tr></thead>";
                                for(var i = 0;i < files.length;i++)
                                {
                                    var row = table.insertRow(i);
                                    var cell = row.insertCell(0);
                                    cell.innerHTML =' <a href="' + directory_path + files[i].toString() + '">' + files[i].toString() + '</a>';
                                    //table += '<tr><td><a href="' + directory_path + files[i].toString() + '">' + files[i].toString() + '</a></td></tr>';
                                }
                                var row = table.insertRow(0);
                                var cell = row.insertCell(0);
                                cell.innerHTML ='<b>Uploads<b>';
                                //table += "</table>";
                                //$("#upload_table").remove();
                                //$("#home").append(table); 
                            }

                            //Printed Status 
                            if(data['OP_printed'] == true)
                            {
                                $("#OP_form").html('<p class="btn btn-success">Printed</p>');
                            }
                            if(data['OPi_printed'] == true)
                            {
                                $("#OPi_form").html('<p class="btn btn-success">Printed</p>');
                            }
                            if(data['OM_printed'] == true)
                            {
                                $("#OM_form").html('<p class="btn btn-success">Printed</p>');
                            }
                            if(data['OMi_printed'] == true)
                            {
                                $("#OMi_form").html('<p class="btn btn-success">Printed</p>');
                            }
                            if(data['OT_printed'] == true)
                            {
                                $("#OT_form").html('<p class="btn btn-success">Printed</p>');
                            }
                            if(data['OTi_printed'] == true)
                            {
                                $("#OTi_form").html('<p class="btn btn-success">Printed</p>');
                            }
                            if(data['G_printed'] == true)
                            {
                                $("#G_form").html('<p class="btn btn-success">Printed</p>');
                            }


                        });
            }
            
            socket.on('country-data',function(country)
            {
                var mt_head = document.getElementById("country_data_table");
                mt_head.innerHTML = '';
                var row = mt_head.insertRow(0);
                var cell = row.insertCell(0);
                cell.innerHTML = '<p style="text-align:right"><img style="width:40px;height:20px;" alt="country image" src= "/media/flags/' + country.country_name + '.png" /></p>'; 
                //ENTER COUNTRY IMAGE HERE
                var cell = row.insertCell(1);
                cell.innerHTML = '<th style="text-align:left">' + country.country_code + '</th>'; 

            });

            //VOTING
            //on receiving vote request
            socket.on('govote',function(id,body,options,time)
            {
                $(document).on("keydown",disableF5);
                var option,Option;
                if(num_of_leaders==2)
                    var optiontext = '<div id="divider-container"><div id = "left-opts" class = "left"><h5>Leader 1</h5></div><div class = "left" id = "right-opts" style = "position:relative"><h5>Leader 2</h5></div><div class = "clear"></div></div>';
                else
                    var optiontext = '<div id="divider-container"><div id = "left-opts" class = "left"><h5>Leader 1</h5></div><div class = "clear"></div></div>';
                $("#vote-opts").html(optiontext);
                for(var i = 1;i<=options.length;i++){
                    if(i!=options.length)
                        option = '<div class = "radio"><label><input type="radio" name = "vote-options" id = "opt'+i+'" value = "opt'+i+'" />'+options[i-1]+'</label></div>';
                    else
                        option = '<div class = "radio"><label><input type="radio" name = "vote-options" id = "opt'+i+'" value = "opt'+i+'" checked="checked" />'+options[i-1]+'</label></div>';
                    Option = $(option);
                    $("#left-opts").append(Option);
                }
                if(num_of_leaders==2)
                {
                    for(var i = 1;i<=options.length;i++){
                        if(i!=options.length)
                            option = '<div class = "radio"><label><input type="radio" name = "vote-options2" id = "opt'+i+'" value = "opt'+i+'" />'+options[i-1]+'</label></div>';
                        else
                            option = '<div class = "radio"><label><input type="radio" name = "vote-options2" id = "opt'+i+'" value = "opt'+i+'" checked="checked" />'+options[i-1]+'</label></div>';
                        Option = $(option);
                        $("#right-opts").append(Option);
                    }
                }
                var dummy_submit = '<button id = "dummy_submit" class = "btn btn-default">Submit</button>';
                var Dummy_submit = $(dummy_submit);
                $("#left-opts").append(Dummy_submit);
                if(num_of_leaders==2)
                {
                    var dummy_submit = '<button id = "dummy_submit2" class = "btn btn-default">Submit</button>';
                    var Dummy_submit = $(dummy_submit);
                    $("#right-opts").append(Dummy_submit);
                }
                //add click event handler to dummy_submit
                $("#dummy_submit").click(function(e){
                    e.preventDefault();
                    $('input[name=vote-options]').attr('disabled',true);
                });
                if(num_of_leaders==2)
                {
                    $("#dummy_submit2").click(function(e){
                        e.preventDefault();
                        $('input[name=vote-options2]').attr('disabled',true);
                    });
                }
                var Body = $('<font style="font-size:18px;">'+body+'</font>');
                $("#vote-body").append(Body);
                $("#cvoteb").show();
                $("#nemo a:eq(-3)").tab('show');
            
                    clearInterval(timer);
                    var startDate = new Date();
                    var startTime = startDate.getTime()/1000;
                    var timer = setInterval(function(){
                var nowDate = new Date();
                var nowTime = nowDate.getTime()/1000;
                var seconds = parseInt(time-nowTime+startTime);
                        $("#timer").parent().show();
                        $("#timer").html(seconds);
                        if(seconds<=0) {
                        logVote(id);
                        clearInterval(timer);
                        }	
                    },1000);
            });
            
            //results came
            socket.on('voteresults',function(counts,body,options)
            {
                $(document).off("keydown",disableF5); 
                var Body = $('<font style="font-size:18px;">'+body+'</font>');
                $("#rvote").append(Body);
                var graph = '<div id = "graph"></div>';
                $("#rvote").append(graph);
                //get total number of counts
                var totalus = 0;
                for(var i in counts)
                    if(i!='_id' && i!='id')
                    {
                        totalus += parseInt(counts[i]);
                    }
                //add graph elements
                    $("#graph").append('<table id = "graph_table" class = "table table-bordered table-hover"></table>');
                var j = 0;
                var maxcount = 0;
                for(var i in counts)
                {
                    if(i!='_id' && i!='id')
                    {
                        if(parseInt(counts[i])>maxcount) 
                        {
                            console.log(options[j]);
                            if(options[j]!='Abstain')
                                maxcount = parseInt(counts[i]);
                        }
                        j++;
                    }
                }
                console.log(maxcount);
                j = 0;
                for(var i in counts)
                    if(i!='_id' && i!='id')
                    {
                        var wid = (parseFloat(counts[i])/totalus)*500;
                        if(options[j]=='Abstain')
                        {
                                var bb = '<tr><td id = "option_name">'+options[j]+'</td><td id = "bar_container"><span id = "bar" style = "height:30px;width:'+wid+'px;background:grey"></span></td><td id = "vote_count">'+counts[i]+'</td></tr>';
                        }
                        else
                        {
                            if(parseInt(counts[i])==maxcount)
                                var bb = '<tr><td id = "option_name">'+options[j]+'</td><td id = "bar_container"><span class ="bar_green" id = "bar" style = "height:30px;width:'+wid+'px;"></span></td><td id = "vote_count">'+counts[i]+'</td></tr>';
                            else
                                var bb = '<tr><td id = "option_name">'+options[j]+'</td><td id = "bar_container"><span class ="bar_red" id = "bar" style = "height:30px;width:'+wid+'px;"></span></td><td id = "vote_count">'+counts[i]+'</td></tr>';
                        }
                        $("#graph_table").append(bb);
                        j++; 
                    }
                $("#rvoteb").show();
                $("#nemo a:eq(-2)").tab('show');
            });

            //MESSAGE BOARD SIGNAL			
            //show the message on board
            socket.on("message-sent",function(message_table)
            {
                $("#message-board-body").html('');
                for(var i in message_table)
                {
                    $("#message-board-body").append("<tr><td>" + message_table[i].message + "</td></tr>");
                }
            });

            //REFRESH SIGNAL
            socket.on('refreshAll',function(){
                    $("#rvote").html('');
                    $("#vote-body").html('');
                    $("#vote-opts").html('');
                    $("#timer").html('');
                    $("#rvoteb").hide();
                    $("#cvoteb").hide();
                    $("#nemo a:eq(0)").tab('show');
            });

            //FEEDBACK ENABLE
            socket.on('fbEnable',function(q){
                if(q=='t1')
                {
                    $("#fbHead").text("Feedback for Q 1-5");
                    get_subparts('t1');
                }
                if(q=='t2')
                {
                    $("#fbHead").text("Feedback for Q 6-10");
                    get_subparts('t2');
                }
                if(q=='t3')
                {
                    $("#fbHead").text("Feedback for Q 10-15");
                    get_subparts('t3');
                }
                if(q=='d')
                {
                    $("#fbHead").text("Feedback for Data");
                    get_subparts('d');
                }   
                if(q=='op')
                {
                    $("#fbHead").text("Feedback for Planetarium");
                    get_subparts('op');
                }   
                if(q=='om')
                {
                    $("#fbHead").text("Feedback for Sky Map");
                    get_subparts('om');
                }   
                if(q=='ot')
                {
                    $("#fbHead").text("Feedback for Telescope");
                    get_subparts('ot');
                }   
                if(q=='g')
                {
                    $("#fbHead").text("Feedback for Group");
                    get_subparts('g');
                }   

                fb_current = q;
                request_fb(fb_current);
                reset_fb_timer();
                $("#fbb").show();
                $("#fbb_all").show();
            });

            function reset_fb_timer()
            {
                clearInterval(fbtimer);
                
                fbtimer = setInterval(function(){
                    request_fb_all(fb_current);    
                },10000);
                request_fb_all(fb_current);
            }

            //FEEDBACK DISABLE
            socket.on('fbDisable',function(){
                $("#nemo a:first").tab('show');
                $("#fbb").hide();
                $("#fbb_all").hide();
            });

            $("#fb_submit").click(function(e){
                e.preventDefault();
                var content = $("#comment").val();
                var id = $("#fbMenu").val();
                
                $("#comment").val('');
                var now = new Date();
                //alert(now.toString());
                socket.emit('fbContent',id,fb_current,content,now.toTimeString());
                request_fb(fb_current);
            });
            
            //FUNCTIONS
            function logVote(id)
            {
                var option = $('input[name=vote-options]:checked').val();
                var option2 = $('input[name=vote-options2]:checked').val();
                socket.emit('logvote',id,option,option2);
                $('input[name=vote-options]').attr('disabled',true);
                $('input[name=vote-options2]').attr('disabled',true);
                $("#timer").parent().hide();
            }
            function emptyfile_check_TOC()
            {
                var file = document.getElementById('file_upload_TOC');
                if(file.value === null || file.value === "")
                {
                    alert("It is not possible to upload an empty file.");
                    return false;
                }
                else
                {
                    alert("File uploaded successfully.");
                    return true;
                }
            }
            function emptyfile_check_T()
            {
                var file = document.getElementById('file_upload_T');
                if(file.value === null || file.value === "")
                {
                    alert("It is not possible to upload an empty file.");
                    return false;
                }
                else
                {
                    alert("File uploaded successfully.");
                    return true;
                }
            }
            function emptyfile_check_TOC()
            {
                var file = document.getElementById('file_upload_TOC');
                if(file.value === null || file.value === "")
                {
                    alert("It is not possible to upload an empty file.");
                    return false;
                }
                else
                {
                    alert("File uploaded successfully.");
                    return true;
                }
            }
            function emptyfile_check_D()
            {
                var file = document.getElementById('file_upload_D');
                if(file.value === null || file.value === "")
                {
                    alert("It is not possible to upload an empty file.");
                    return false;
                }
                else
                {
                    alert("File uploaded successfully.");
                    return true;
                }
            }
            function emptyfile_check_OP()
            {
                var file = document.getElementById('file_upload_OP');
                if(file.value === null || file.value === "")
                {
                    alert("It is not possible to upload an empty file.");
                    return false;
                }
                else
                {
                    alert("File uploaded successfully.");
                    return true;
                }
            }
            function emptyfile_check_OPi()
            {
                var file = document.getElementById('file_upload_OPi');
                if(file.value === null || file.value === "")
                {
                    alert("It is not possible to upload an empty file.");
                    return false;
                }
                else
                {
                    alert("File uploaded successfully.");
                    return true;
                }
            }
            function emptyfile_check_OM()
            {
                var file = document.getElementById('file_upload_OM');
                if(file.value === null || file.value === "")
                {
                    alert("It is not possible to upload an empty file.");
                    return false;
                }
                else
                {
                    alert("File uploaded successfully.");
                    return true;
                }
            }
            function emptyfile_check_OMi()
            {
                var file = document.getElementById('file_upload_OMi');
                if(file.value === null || file.value === "")
                {
                    alert("It is not possible to upload an empty file.");
                    return false;
                }
                else
                {
                    alert("File uploaded successfully.");
                    return true;
                }
            }
            function emptyfile_check_OT()
            {
                var file = document.getElementById('file_upload_OT');
                if(file.value === null || file.value === "")
                {
                    alert("It is not possible to upload an empty file.");
                    return false;
                }
                else
                {
                    alert("File uploaded successfully.");
                    return true;
                }
            }
            function emptyfile_check_OTi()
            {
                var file = document.getElementById('file_upload_OTi');
                if(file.value === null || file.value === "")
                {
                    alert("It is not possible to upload an empty file.");
                    return false;
                }
                else
                {
                    alert("File uploaded successfully.");
                    return true;
                }
            }
            function emptyfile_check_G()
            {
                var file = document.getElementById('file_upload_G');
                if(file.value === null || file.value === "")
                {
                    alert("It is not possible to upload an empty file.");
                    return false;
                }
                else
                {
                    alert("File uploaded successfully.");
                    return true;
                }
            }
        </script>
	   
	</body>
</html>
